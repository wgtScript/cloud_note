<!DOCTYPE html>
<html>
<head>
	<title>笔记列表</title>
	<meta charset="utf-8"></meta>
	<!-- TopJUI框架样式 -->
    <link type="text/css" href="css/topjui.core.min.css" rel="stylesheet">
    <link type="text/css" href="css/topjui.blue.css" rel="stylesheet" id="dynamicTheme"/>
    <!-- FontAwesome字体图标 -->
    <link type="text/css" href="static/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet"/>

    <!-- layui框架样式 -->
    <link type="text/css" href="css/layui.css" rel="stylesheet"/>
	
	<!---  添加页面相关  -->
	<link rel="stylesheet" href="css/bootstrap.css" />
	<!-- <script charset="utf-8" src="js/kindeditor-min.js"></script>
	<script charset="utf-8" src="lang/zh_CN.js"></script> -->


	<!-- jQuery相关引用 -->
    <script type="text/javascript" src="static/plugins/jquery/jquery.min.js"></script>

	<!-- TopJUI框架配置 -->
    <script type="text/javascript" src="js/topjui.config.js"></script>
	<!-- TopJUI框架核心-->
    <script type="text/javascript" src="js/topjui.core.min.js"></script>
	<style>
		body.panel-noscroll >div.datagrid > div.panel-body {padding: 0;}
		.datagrid-cell-rownumber{overflow:visible}
	</style>

</head>
<body>
	
	<table id="productDg"></table>
	<!-- 表格工具栏开始 -->
	<div id="productDg-toolbar" class="topjui-toolbar"
	     data-options="grid:{
	           type:'datagrid',
	           id:'productDg'
	       }">
	    <a href="javascript:void(0)"
	       data-toggle="topjui-menubutton"
	       data-options="method:'openDialog',
	       extend: '#productDg-toolbar',
	       iconCls: 'fa fa-plus',
	       dialog:{
	           id:'userAddDialog',
	           title:'新增笔记',
			   href:'addReadNote.html',
			   height:'700',
			   editor:[
					{id:'contentAddEditor',field:'noteContent'}
				],
	           buttonsGroup:[ 
	               {text:'保存',url:'http://127.0.0.1:8081/last_1/addReadNote.do',iconCls:'fa fa-plus',handler:'ajaxForm',btnCls:'topjui-btn-green'}
	           ]
	       }">新增</a>
		<!-- <a id="edit">编辑</a> -->
		<a id="detail">编辑</a>
	    
	    <form id="queryForm" class="search-box">
	        <input type="text" name="teacherName" data-toggle="topjui-combobox"
	               data-options="id:'teacherName',prompt:'讲师',width:150,
	               url:'http://127.0.0.1:8081/last_1/getNoteName.do?col=teacher_name',
				   valueField:'teacher_name',
				   textField:'teacher_name'
	               
	               ">
	        <input type="text" name="noteName" data-toggle="topjui-combobox"
				   data-options="id:'noteName',prompt:'书名',width:200, 
				   url:'http://127.0.0.1:8081/last_1/getNoteName.do?col=note_name',
				    valueField:'note_name',
				    textField:'note_name'">
			<input type="text" name="noteSummary" data-toggle="topjui-textbox"
	               data-options="id:'noteSummary',prompt:'内容摘要',width:100">
	        <input type="text" name="chapterNo" data-toggle="topjui-textbox"
	               data-options="id:'chapterNo',prompt:'章节号',width:100">
	        <a href="javascript:void(0)"
	           data-toggle="topjui-menubutton"
	           data-options="method:'query',
	           iconCls:'fa fa-search',
	           btnCls:'topjui-btn-blue',
	           form:{id:'queryForm'},
	           grid:{type:'datagrid','id':'productDg'}">查询</a>
	    </form>
	</div>

	<script>
		$('#productDg').iDatagrid({
			url:'http://127.0.0.1:8081/last_1/getReadNoteList.do',
			toolbar: '#productDg-toolbar',
			// data:res.rows,
			singleSelect: false,
			checkOnSelect: true,
			selectOnCheck: true,
			pagination:true, 
			fitColumns:true,
			singleSelect:true,
			multiSort:true,
			pageSize:20,
			columns:[[
				{field:'id',title:'uuid',checkbox:true},
				{field:'noteName',title:'书名',width:100,sortable:true},
				{field:'chapterNo',title:'章节号',width:50,sortable:true},
				{field:'teacherName',title:'讲师',width:100,sortable:true},
				{field:'noteSummary',title:'内容摘要',width:500,align:'left',sortable:true},
				{field:'createTime',title:'创建时间',width:140,sortable:true,align:'center'},
				{field:'operate',title:'操作',formatter:operateFormatter,width:80,align:'center'}
			]]
		});

		$('#detail').iMenubutton({
            //btnCls:'topjui-btn-purple',
            iconCls:'fa fa-search',
            method:'openDialog',
			grid:{type:'datagrid','id':'productDg',multiCheck: 0,singleSelect: 1,uncheckedMsg: '请先选择数据'},
            dialog:{
               id:'detailDialog',
               href:'readNoteDetail.html',
               height:'700',
			   url:'http://127.0.0.1:8081/last_1/getReadNote2.do?id={id}',
               editor:[
					{id:'contentAddEditor',field:'noteContent'}
				],
               title:'笔记修改',
               buttonsGroup:[ 
	               {text:'保存',url:'http://127.0.0.1:8081/last_1/addReadNote.do',iconCls:'fa fa-plus',handler:'ajaxForm',btnCls:'topjui-btn-green'}
	           ]
               //resizable:false,
            }
        });
		function operateFormatter(value, row, index) {
	        var htmlstr = '<button class="layui-btn layui-btn-xs" onclick="openEditDiag(\'' + row.id + '\')">编辑</button>';
	        htmlstr += '<button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRow(\'' + row.id + '\')">删除</button>';
	        return htmlstr;
	    }
		
		function openEditDiag(id) {
	        var $editDialog = $('<form></form>');
	        $editDialog.iDialog({
	            title: '编辑数据',
	            width: 950,
	            height: 500,
	            closed: false,
	            cache: false,
	            href: 'readNoteDetail.html?id=' + id,
	            modal: true,
	            buttons: [{
	                text: '保存',
	                iconCls: 'fa fa-save',
	                btnCls: 'topjui-btn-blue',
	                handler: function () {
	                    // 提示信息
	                    $.iMessager.alert('操作提示', '请根据具体情况编写代码，如ajax更新请求，请求失败提示，请求成功提示，请求成功后关闭窗口并刷新表格等！', 'messager-info');
	                }
	            }, {
	                text: '关闭',
	                iconCls: 'fa fa-close',
	                btnCls: 'topjui-btn-red',
	                handler: function () {
	                    $editDialog.iDialog('close');
	                }
	            }],
	            onLoad: function () {
	                //加载表单数据
	                $.getJSON('http://127.0.0.1:8081/last_1/getReadNote2.do?id=' + id, function (data) {
	                    $editDialog.form('load', data);
	                    /* $editDialog.editor([
	    					{id:'contentAddEditor',field:'noteContent'}
	    					]); */
	                });
	            }
	        });
	    }

	    function deleteRow(id) {
	    	 $.iMessager.confirm('确认对话框', '确定删除该笔记吗？', function(r){
    		    if (r){
    		    	$.ajax({
    		    		url:'http://127.0.0.1:8081/last_1/deleteReadNote.do',
    		    		type:'post',
    		    		data:{id:id},
    		    		success:function(data){
		    		    	$.iMessager.alert(data.title,data.message);
		    		    	$('#productDg').iDatagrid('reload');
    		    		}
    		    	});
    		    } 
    		});
	    }
		
		
	</script>
	<!-- Ueditor编辑器插件 -->
	<script type="text/javascript" src="static/plugins/ueditor/ueditor.config.js"></script>
	<script type="text/javascript" src="static/plugins/ueditor/ueditor.all.min.js"></script>
</body>
</html>